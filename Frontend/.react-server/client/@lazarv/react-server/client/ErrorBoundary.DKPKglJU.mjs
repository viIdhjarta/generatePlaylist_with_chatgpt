import{j as u}from"../../../react/jsx-runtime.BfNg0mxH.mjs";import{r as a}from"../../../react.DaX-6B7k.mjs";import{FlightContext as f,FlightComponentContext as m,useClient as y,PAGE_ROOT as x}from"./context.1OmqlEwD.mjs";const p=a.createContext(null);function w(){const r=a.useContext(p),[e,t]=a.useState({error:null,hasError:!1}),o=a.useMemo(()=>({resetBoundary:()=>{r.resetErrorBoundary(),t({error:null,hasError:!1})},showBoundary:n=>t({error:n,hasError:!0})}),[r.resetErrorBoundary]);if(e.hasError)throw e.error;return o}const l={didCatch:!1,error:null};class B extends a.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=l}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}async resetErrorBoundary(...e){const{error:t}=this.state;t!==null&&(await this.props.onReset?.({args:e,reason:"imperative-api",error:t,resetErrorBoundary:this.resetErrorBoundary}),typeof t?.digest!="string"&&this.setState(l))}componentDidCatch(e,t){this.props.onError?.(e,t)}componentDidUpdate(e,t){const{didCatch:o}=this.state,{resetKeys:n}=this.props;if(o&&t.error!==null&&g(e.resetKeys,n))if(typeof this.props.onReset=="function"){const c=this.props.onReset({next:n,prev:e.resetKeys,reason:"keys"});typeof c?.then=="function"?c.then(()=>{this.setState(l)}):this.setState(l)}else this.setState(l)}render(){const{children:e,fallbackRender:t,FallbackComponent:o,fallback:n}=this.props,{didCatch:c,error:s}=this.state;s?.message==="Redirect"&&s?.digest.startsWith("Location=")&&(s.redirectTo=s.digest.slice(9));let i=e;if(c){const d={error:s,resetErrorBoundary:this.resetErrorBoundary};if(delete s.stack,typeof t=="function")i=t(d);else if(o)i=a.createElement(o,d);else if(n===null||a.isValidElement(n))i=n;else throw s}return u.jsx(p.Provider,{value:{didCatch:c,error:s,resetErrorBoundary:this.resetErrorBoundary},children:i})}}function g(r=[],e=[]){return r.length!==e.length||r.some((t,o)=>!Object.is(t,e[o]))}function C({FallbackComponent:r,fallbackRender:e,...t}){const{outlet:o}=a.useContext(f),n=y(),{navigate:c}=n,{error:s}=t,{redirectTo:i}=s;return a.useEffect(()=>{i&&c(i,{outlet:o,external:o!==x})},[i,c,o]),i?null:u.jsxs(u.Fragment,{children:[r&&typeof r=="function"?u.jsx(r,{...t}):r,e?.(t)]})}function R({error:r}){if(r)throw r;return null}function T({component:r,render:e,onReset:t,global:o,children:n,...c}){const{outlet:s}=a.useContext(f),{resourceKey:i,error:d}=a.useContext(m),{invalidate:E}=y();return u.jsxs(B,{...c,onReset:async h=>{typeof h.error?.digest=="string"&&await E(s),t?.(h)},fallbackRender:h=>u.jsx(C,{FallbackComponent:r,fallbackRender:e,...h}),children:[u.jsx(R,{error:d}),n]},`${s}_${i}`)}export{B as ErrorBoundary,T as default,w as useErrorBoundary};
