import{jsx as g,Fragment as M,jsxs as W}from"react/jsx-runtime";import{ReadableStream as le}from"node:stream/web";import A from"react-server-dom-webpack/server.edge";import{g as e,C as Se,H as we,i as ye,R as _e,u as Ce,F as Oe,a as F,c as O,A as xe,b as Y,d as z,e as q,f as J,S as Pe,h as be,r as Ae,E as He,j as Ne,k as H,l as ue,m as ve,n as Q,o as V,p as Z,q as ee,s as de,t as te,P as Me,v as Fe,I as qe,w as fe,M as De,x as Ie,y as Le,L as $e}from"./@lazarv/react-server.C71Mx6-w.mjs";import"node:path";import"node:url";import"node:async_hooks";import"node:worker_threads";import"picocolors";const U=new Proxy({},{get(x,S){if(!x[S]){const[X,N]=S.split("#");x[S]={id:`server://${X}`,name:N,chunks:[]}}return x[S]}});async function ze(x,S={},X={}){const N=e($e),me=e(Le),G=e(Ie)?.[Se];try{return new Promise(async(m,re)=>{const a=e(we);try{ye();const h=a.request.headers.get("origin"),pe=h&&new URL(h).protocol,ne=a.request.headers.get("host"),p=e(_e),P=p.flags.isRemote,R=Ce();let D,b,E;const j=a.request.headers.get("content-type")?.includes("multipart/form-data");let he;const w=decodeURIComponent(a.request.headers.get("react-server-action")??null);if("POST,PUT,PATCH,DELETE".includes(a.request.method)&&(w&&w!=="null"||j)&&!X.skipFunction){let t=async function(){throw new Error("Server action not found")},r=[];if(j){const o={},f=await e(Oe)(a.request,{handleFile:async({body:i,...s})=>{const c=[];for await(const l of i)c.push(l);const d=`__react_server_file_${s.name}__`;return o[d]={info:s,file:new Blob(c,{type:s.contentType})},d}}),u=new FormData;for(const[i,s]of f.entries())if(o[s]){const{info:c,file:d}=o[s];u.append(i,d,c.filename)}else u.append(i.replace(/^remote:/,""),s);try{r=await A.decodeReply(u,U)}catch{r=u}}else r=await A.decodeReply(await a.request.text(),U);if(w&&w!=="null"){const[o,f]=w.split("#");t=async()=>{try{return{data:await(await globalThis.__webpack_require__(o))[f].bind(null,...r)(),actionId:w,error:null}}catch(u){return{data:null,actionId:w,error:u}}}}else t=await A.decodeAction(r[r.length-1]??r,U);if(typeof t!="function"){const o=new Error("Server Function Not Found");throw o.digest=o.message,o}const{data:n,actionId:y,error:_}=await t();if(!j)D=_?Promise.reject(_):n instanceof Buffer?n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength):n,b=!0;else{const o=await A.decodeFormState(n,r[r.length-1]??r,U);if(o){const[f,u]=o;D=f,b=!0,E={"React-Server-Action-Key":encodeURIComponent(u)}}}const C=e(F);if(p.flags.isHTML&&C?.response)return m(C.response);O(xe,{formData:r[r.length-1]??r,data:n,error:_,actionId:y})}const oe=a.request.headers.get("if-modified-since"),B=a.request.headers.get("cache-control")==="no-cache",Re=p.flags.isRSC?Y:z;if(oe&&!B&&await e(q)?.get([a.url,"text/x-component",R,Re,oe])!==J)return m(new Response(null,{status:304,statusText:"Not Modified"}));const Te=P||/^https?___/.test(R)?void 0:"default",ae=G.base?t=>`/${G.base}/${t?.id||t}`.replace(/\/+/g,"/"):t=>t?.id||t,Ee=P||h&&ne!==h?t=>`${pe}//${ne}${ae(t)}`:ae,ce=()=>{const t=e(Pe);return g(M,{children:t.map(r=>{const n=Ee(r);return g("link",{rel:"stylesheet",href:n,precedence:Te},n)})})},ie=W(M,{children:[g(ce,{}),g(x,{...S})]}),I=e(be)??!1;I&&(E={...E,"React-Server-Render":I.url.toString(),"React-Server-Outlet":I.outlet});const K=e(F);K?.response&&(E={...E,"React-Server-Render":K.location,"React-Server-Outlet":"PAGE_ROOT"},Ae(K.location));let L=ie;if(b&&(E={...E,"React-Server-Data":"rsc"},L=I?W(M,{children:[ie,D]}):g(M,{children:[D]})),!P&&!b&&(!R||R&&R==="PAGE_ROOT")){const t=e(He);if(t&&t.$$typeof===Symbol.for("react.client.reference")){const r=e(Ne);r&&(L=W(M,{children:[g(ce,{}),g(r,{component:t,children:g(x,{...S})})]}))}}const $=new Date().toUTCString();if(p.flags.isRSC&&!p.flags.isRemote){if(!B&&!b){const n=await e(q)?.get([a.url,"text/x-component",R,Y]);if(n!==J)return m(new Response(n.buffer,{status:n.status,statusText:n.statusText,headers:n.headers}))}let t=!1;const r=new le({type:"bytes",async start(n){const y=e(H);O(H,new Headers({"content-type":"text/x-component; charset=utf-8","cache-control":a.request.headers.get("cache-control")==="no-cache"?"no-cache":"must-revalidate","last-modified":$,...E,...y?Object.fromEntries(y.entries()):{}}));const C=A.renderToReadableStream(L,ue({remote:P,origin:h}),{onError(l){t=!0;const T=e(F);return T?.response?`Location=${T.response.headers.get("location")}`:l?.message}}).getReader();let o=!1;const f=[],u=new Promise(l=>ve(()=>l("interrupt")));let i=null;for(;!o;){const l=i||C.read(),T=await Promise.race([l,e(Q)??u]);if(T===Q){O(Q,null),i=l;continue}else if(T==="interrupt"){i=l;break}i=null;const{value:v,done:k}=T;o=k,v&&f.push(V(v))}n.enqueue(new Uint8Array(Z(f)));const s=e(ee)??{status:200,statusText:"OK"},c=e(H)??new Headers,d=new Response(r,{...s,headers:c});for(O(de,d),m(d);!o;){const{value:l,done:T}=await(i||C.read());i=null,o=T,l&&(f.push(V(l)),n.enqueue(l))}n.close(),t||e(q)?.set([a.url,"text/x-component",R,Y,$],{...s,buffer:Z(f),headers:c})}})}else if(p.flags.isHTML||p.flags.isRemote){if(!B&&!b){const s=await e(q)?.get([a.url,"text/html",R,z]);if(s!==J){const c=new le({type:"bytes",async start(d){d.enqueue(new Uint8Array(s.buffer)),d.close()}});return m(new Response(c,{status:s.status,statusText:s.statusText,headers:s.headers}))}}const t=e(H);O(H,new Headers({"content-type":"text/html; charset=utf-8","cache-control":a.request.headers.get("cache-control")==="no-cache"?"no-cache":"must-revalidate","last-modified":$,...t?Object.fromEntries(t.entries()):{}}));let r=!1;const n=A.renderToReadableStream(L,ue({remote:P,origin:h}),{onError(s){r=!0;const c=e(F);return c?.response?m(c.response):s?.message}}),y=te.getStore(),{onPostponed:_}=a,C=e(Me),o=e(Fe),f=e(qe);let u=!1;const i=await me({stream:n,bootstrapModules:p.flags.isRSC||p.flags.isRemote?[]:e(De),bootstrapScripts:p.flags.isRSC||p.flags.isRemote?[]:[`const moduleCache = new Map();
                    self.__webpack_require__ = function (id) {
                      if (!moduleCache.has(id)) {
                        const modulePromise = /^https?\\:/.test(id) ? import(id) : import(("${`/${G.base??""}/`.replace(/\/+/g,"/")}" + id).replace(/\\/+/g, "/"));
                        modulePromise.then(
                          (module) => {
                            modulePromise.value = module;
                            modulePromise.status = "fulfilled";
                          },
                          (reason) => {
                            modulePromise.reason = reason;
                            modulePromise.status = "rejected";
                          }
                        );
                        moduleCache.set(id, modulePromise);
                      }
                      return moduleCache.get(id);
                    };`.replace(/\n/g,"")],outlet:R,defer:a.request.headers.get("react-server-defer")==="true",start:async()=>{u=!0,te.run(y,async()=>{const s=e(F);if(s?.response)return m(s.response);const c=e(ee)??{status:200,statusText:"OK"},d=e(H)??new Headers,[l,T]=i.tee(),v=[];(async()=>{if(!r){for await(const ge of T)v.push(V(ge));await e(q)?.set([a.url,"text/html",R,z,$],{...c,buffer:Z(v),headers:d})}})();const k=new Response(l,{...c,headers:d});O(de,k),m(k)})},onError(s,c){c&&(s.digest=c),N.error(s),r=!0,u||te.run(y,async()=>{O(ee,{status:500,statusText:"Internal Server Error"}),e(fe)?.(s)?.then(m,re)})},formState:he,isPrerender:typeof _=="function",onPostponed:_,prelude:C,postponed:o,remote:P,origin:h,importMap:f})}else return m(new Response(null,{status:404,statusText:"Not Found"}))}catch(h){N.error(h),e(fe)?.(h)?.then(m,re)}})}catch(se){return N.error(se),new Response(null,{status:500,statusText:"Internal Server Error"})}}export{ze as render};
